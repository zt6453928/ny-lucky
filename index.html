<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>üéâ Êñ∞Âπ¥Á¶èÂà©ÊäΩÂ•ñ</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

:root {
  --red: #e74c3c;
  --gold: #f1c40f;
  --deep-red: #c0392b;
}

html, body {
  width: 100%; height: 100%;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  color: #fff;
  overflow-x: hidden;
  user-select: none;
  -webkit-user-select: none;
}

/* ====== Background ====== */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  background: url('assets/bg.jpg') center/cover no-repeat;
  z-index: -2;
}

body::after {
  content: '';
  position: fixed;
  inset: 0;
  background: linear-gradient(to bottom, rgba(0,0,0,0) 0%, rgba(0,0,0,0.15) 35%, rgba(0,0,0,0.5) 100%);
  z-index: -1;
}

/* ====== Lanterns ====== */
.lantern {
  position: fixed;
  top: -10px;
  width: 40px;
  height: 55px;
  background: radial-gradient(ellipse, #ff4444, #cc0000);
  border-radius: 50%;
  box-shadow: 0 0 20px rgba(255,50,50,0.4);
  z-index: 1;
  animation: sway 3s ease-in-out infinite;
}
.lantern::before {
  content: '';
  position: absolute;
  top: -8px; left: 50%; transform: translateX(-50%);
  width: 16px; height: 10px;
  background: var(--gold);
  border-radius: 3px 3px 0 0;
}
.lantern::after {
  content: '';
  position: absolute;
  bottom: -12px; left: 50%; transform: translateX(-50%);
  width: 2px; height: 14px;
  background: var(--gold);
  box-shadow: -4px 6px 0 var(--gold), 4px 6px 0 var(--gold);
}
.lantern:nth-child(1) { left: 5%; animation-delay: 0s; }
.lantern:nth-child(2) { right: 5%; left: auto; animation-delay: 1.5s; }

@keyframes sway {
  0%, 100% { transform: rotate(-5deg); }
  50% { transform: rotate(5deg); }
}

/* ====== Main Container ====== */
.container {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-end;
  padding: 16px 16px 24px;
  position: relative;
  z-index: 2;
}

/* ====== Header ====== */
.header {
  text-align: center;
  margin-bottom: 16px;
}

.title {
  font-size: 32px;
  font-weight: 800;
  background: linear-gradient(135deg, var(--gold), #e67e22, var(--gold));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  letter-spacing: 2px;
  margin-bottom: 4px;
  text-shadow: none;
  filter: drop-shadow(0 2px 6px rgba(0,0,0,0.5));
}

.subtitle {
  font-size: 14px;
  color: rgba(255,255,255,0.7);
  letter-spacing: 1px;
  text-shadow: 0 1px 4px rgba(0,0,0,0.6);
}

/* ====== Slot Machine ====== */
.slot-machine {
  background: rgba(0, 0, 0, 0.35);
  border: 1px solid rgba(241,196,15,0.2);
  border-radius: 20px;
  padding: 20px 18px;
  width: 100%;
  max-width: 340px;
  text-align: center;
  position: relative;
  box-shadow: 0 0 30px rgba(0,0,0,0.3);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}

.slot-machine::before {
  content: '';
  position: absolute;
  inset: -1px;
  border-radius: 20px;
  background: linear-gradient(135deg, rgba(241,196,15,0.1), transparent, rgba(241,196,15,0.05));
  z-index: -1;
}

/* Prize display */
.prize-window {
  background: rgba(0,0,0,0.25);
  border: 1px solid rgba(255,255,255,0.06);
  border-radius: 14px;
  padding: 18px 14px;
  margin-bottom: 16px;
  min-height: 100px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: relative;
  overflow: hidden;
}

.prize-emoji {
  font-size: 48px;
  margin-bottom: 6px;
  transition: transform 0.3s;
}

.prize-text {
  font-size: 20px;
  font-weight: 700;
  color: var(--gold);
  letter-spacing: 1px;
}

.prize-amount {
  font-size: 16px;
  color: rgba(255,255,255,0.5);
  margin-top: 4px;
}

.prize-window.rolling .prize-emoji {
  animation: rollEmoji 0.12s linear infinite;
}

@keyframes rollEmoji {
  0% { transform: translateY(-100%) scale(0.8); opacity: 0; }
  50% { transform: translateY(0) scale(1); opacity: 1; }
  100% { transform: translateY(100%) scale(0.8); opacity: 0; }
}

.prize-window.reveal .prize-emoji {
  animation: revealPop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
}

@keyframes revealPop {
  0% { transform: scale(0) rotate(-180deg); opacity: 0; }
  100% { transform: scale(1) rotate(0deg); opacity: 1; }
}

/* Draw button */
.draw-btn {
  width: 100%;
  padding: 14px;
  border: none;
  border-radius: 14px;
  font-size: 18px;
  font-weight: 700;
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
  letter-spacing: 2px;
  background: linear-gradient(135deg, var(--red), var(--deep-red));
  color: #fff;
  box-shadow: 0 4px 20px rgba(231,76,60,0.4);
  position: relative;
  overflow: hidden;
}

.draw-btn::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, rgba(255,255,255,0.1), transparent);
  pointer-events: none;
}

.draw-btn:active:not(:disabled) { transform: scale(0.96); }
.draw-btn:disabled {
  opacity: 0.4;
  cursor: not-allowed;
  box-shadow: none;
}

.remaining {
  margin-top: 10px;
  font-size: 13px;
  color: rgba(255,255,255,0.4);
  letter-spacing: 1px;
}

.remaining strong {
  color: var(--gold);
  font-size: 16px;
}

/* ====== Prize Table ====== */
.prize-table {
  width: 100%;
  max-width: 340px;
  margin-top: 14px;
  background: rgba(0,0,0,0.3);
  border: 1px solid rgba(255,255,255,0.06);
  border-radius: 14px;
  overflow: hidden;
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
}

.prize-table-title {
  padding: 8px;
  text-align: center;
  font-size: 12px;
  color: rgba(255,255,255,0.4);
  border-bottom: 1px solid rgba(255,255,255,0.06);
  letter-spacing: 2px;
}

.prize-row {
  display: flex;
  align-items: center;
  padding: 7px 14px;
  border-bottom: 1px solid rgba(255,255,255,0.04);
  transition: background 0.3s;
}

.prize-row:last-child { border-bottom: none; }
.prize-row.won { background: rgba(241,196,15,0.08); }

.prize-row .rank {
  font-size: 12px;
  color: rgba(255,255,255,0.5);
  width: 60px;
  flex-shrink: 0;
}

.prize-row .amount {
  flex: 1;
  font-size: 13px;
  font-weight: 600;
  color: var(--gold);
}

.prize-row .prob {
  font-size: 12px;
  color: rgba(255,255,255,0.25);
}

/* ====== History ====== */
.history {
  width: 100%;
  max-width: 340px;
  margin-top: 12px;
}

.history-title {
  font-size: 12px;
  color: rgba(255,255,255,0.3);
  margin-bottom: 8px;
  text-align: center;
  letter-spacing: 2px;
}

.history-list {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.history-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 12px;
  background: rgba(0,0,0,0.2);
  border-radius: 8px;
  font-size: 13px;
  animation: slideIn 0.3s ease;
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
}

@keyframes slideIn {
  from { opacity: 0; transform: translateX(-20px); }
  to { opacity: 1; transform: translateX(0); }
}

.history-item .h-num {
  color: rgba(255,255,255,0.3);
  font-size: 12px;
  width: 30px;
}

.history-item .h-prize {
  flex: 1;
  font-weight: 600;
}

.history-item .h-amount {
  color: var(--gold);
  font-weight: 700;
}

/* ====== Footer ====== */
.footer {
  margin-top: 14px;
  text-align: center;
  padding: 10px;
  max-width: 340px;
}

.footer p {
  font-size: 13px;
  color: rgba(255,255,255,0.4);
  line-height: 1.6;
  text-shadow: 0 1px 3px rgba(0,0,0,0.5);
}

.footer .highlight {
  color: var(--gold);
  font-weight: 600;
}

/* ====== Confetti ====== */
.confetti-piece {
  position: fixed;
  width: 10px;
  height: 10px;
  z-index: 100;
  pointer-events: none;
  animation: confettiFall linear forwards;
}

@keyframes confettiFall {
  0% { opacity: 1; transform: translateY(0) rotate(0deg); }
  100% { opacity: 0; transform: translateY(100vh) rotate(720deg); }
}

/* Big win glow */
.big-win-glow {
  position: absolute;
  inset: 0;
  border-radius: 16px;
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.5s;
}

.big-win-glow.active {
  opacity: 1;
  animation: glowPulse 1s ease-in-out infinite;
}

@keyframes glowPulse {
  0%, 100% { box-shadow: inset 0 0 30px rgba(241,196,15,0.2), 0 0 40px rgba(241,196,15,0.1); }
  50% { box-shadow: inset 0 0 50px rgba(241,196,15,0.35), 0 0 60px rgba(241,196,15,0.2); }
}

/* ====== Background particles ====== */
.bg-particle {
  position: fixed;
  border-radius: 50%;
  pointer-events: none;
  z-index: 0;
  animation: floatUp linear infinite;
}

@keyframes floatUp {
  0% { transform: translateY(100vh) scale(0); opacity: 0; }
  10% { opacity: 1; }
  90% { opacity: 1; }
  100% { transform: translateY(-20vh) scale(1); opacity: 0; }
}

@media (max-width: 400px) {
  .title { font-size: 26px; }
  .slot-machine { padding: 16px 14px; }
  .prize-emoji { font-size: 42px; }
}
</style>
</head>
<body>

<div class="lantern"></div>
<div class="lantern"></div>

<div class="container">
  <div class="header">
    <h1 class="title">üéâ Êñ∞Âπ¥Á¶èÂà© üéâ</h1>
    <p class="subtitle">ÊØè‰∫∫ÂèØÊäΩ 5 Ê¨°</p>
  </div>

  <div class="slot-machine">
    <div class="prize-window" id="prizeWindow">
      <div class="big-win-glow" id="bigWinGlow"></div>
      <div class="prize-emoji" id="prizeEmoji">üßß</div>
      <div class="prize-text" id="prizeText">ËØïËØïÊâãÊ∞î</div>
      <div class="prize-amount" id="prizeAmount"></div>
    </div>

    <button class="draw-btn" id="drawBtn">ÂºÄÂßãÊäΩÂ•ñ</button>

    <div class="remaining" id="remaining">
      Ââ©‰ΩôÊ¨°Êï∞Ôºö<strong id="remainCount">5</strong> / 5
    </div>
  </div>

  <div class="prize-table">
    <div class="prize-table-title">Â•ñÂìÅÂàóË°®</div>
    <div class="prize-row" data-tier="1">
      <span class="rank">‰∏ÄÁ≠âÂ•ñ</span>
      <span class="amount">100 üßß</span>
      <span class="prob">5%</span>
    </div>
    <div class="prize-row" data-tier="2">
      <span class="rank">‰∫åÁ≠âÂ•ñ</span>
      <span class="amount">52 üßß</span>
      <span class="prob">20%</span>
    </div>
    <div class="prize-row" data-tier="3">
      <span class="rank">‰∏âÁ≠âÂ•ñ</span>
      <span class="amount">20 üßß</span>
      <span class="prob">30%</span>
    </div>
    <div class="prize-row" data-tier="4">
      <span class="rank">ÂõõÁ≠âÂ•ñ</span>
      <span class="amount">10 üßß</span>
      <span class="prob">25%</span>
    </div>
    <div class="prize-row" data-tier="5">
      <span class="rank">‰∫îÁ≠âÂ•ñ</span>
      <span class="amount">2 üßß</span>
      <span class="prob">20%</span>
    </div>
  </div>

  <div class="history" id="historySection" style="display:none;">
    <div class="history-title">ÊäΩÂ•ñËÆ∞ÂΩï</div>
    <div class="history-list" id="historyList"></div>
  </div>

  <div class="footer">
    <p>ÊäΩÂà∞Â•ñÂìÅÂêé <span class="highlight">Êà™Âõæ</span> Êù•ÊâæÊàëÈ¢ÜÂ•ñ üéÅ</p>
  </div>
</div>

<script>
// ====== Prizes ======
const prizes = [
  { tier: 1, name: '‰∏ÄÁ≠âÂ•ñ', amount: 100, emoji: 'üèÜ', prob: 0.05 },
  { tier: 2, name: '‰∫åÁ≠âÂ•ñ', amount: 52,  emoji: 'üéä', prob: 0.20 },
  { tier: 3, name: '‰∏âÁ≠âÂ•ñ', amount: 20,  emoji: 'üéÅ', prob: 0.30 },
  { tier: 4, name: 'ÂõõÁ≠âÂ•ñ', amount: 10,  emoji: 'üßß', prob: 0.25 },
  { tier: 5, name: '‰∫îÁ≠âÂ•ñ', amount: 2,   emoji: 'üéã', prob: 0.20 },
];

const rollingEmojis = ['üßß', 'üéÅ', 'üèÜ', 'üéä', 'üéã', 'üí∞', 'üéâ', 'üéÜ', '‚ú®', 'üéá'];

// ====== State ======
const STORAGE_KEY = 'ny_lucky_2026';
let state = loadState();

function loadState() {
  try {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) {
      const s = JSON.parse(saved);
      if (s.remaining >= 0 && s.remaining <= 5) return s;
    }
  } catch(e) {}
  return { remaining: 5, history: [] };
}

function saveState() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

// ====== Audio ======
const AudioCtx = window.AudioContext || window.webkitAudioContext;
let audioCtx;
function ensureAudio() {
  if (!audioCtx) audioCtx = new AudioCtx();
  if (audioCtx.state === 'suspended') audioCtx.resume();
}

function playTick() {
  try {
    ensureAudio();
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.connect(gain); gain.connect(audioCtx.destination);
    osc.type = 'sine';
    osc.frequency.value = 800 + Math.random() * 400;
    const t = audioCtx.currentTime;
    gain.gain.setValueAtTime(0.06, t);
    gain.gain.exponentialRampToValueAtTime(0.001, t + 0.05);
    osc.start(t); osc.stop(t + 0.05);
  } catch(e) {}
}

function playWin(tier) {
  try {
    ensureAudio();
    const notes = tier <= 2
      ? [523, 659, 784, 1047, 1318]
      : [440, 554, 659];
    notes.forEach((freq, i) => {
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.connect(gain); gain.connect(audioCtx.destination);
      osc.type = 'sine';
      const t = audioCtx.currentTime + i * 0.12;
      osc.frequency.value = freq;
      gain.gain.setValueAtTime(0.12, t);
      gain.gain.exponentialRampToValueAtTime(0.001, t + 0.2);
      osc.start(t); osc.stop(t + 0.2);
    });
    if (navigator.vibrate) {
      navigator.vibrate(tier <= 2 ? [50, 30, 50, 30, 100] : [30, 20, 30]);
    }
  } catch(e) {}
}

// ====== Drawing ======
function drawPrize() {
  const rand = Math.random();
  let cumulative = 0;
  for (const p of prizes) {
    cumulative += p.prob;
    if (rand < cumulative) return p;
  }
  return prizes[prizes.length - 1];
}

let isDrawing = false;

function startDraw() {
  if (isDrawing || state.remaining <= 0) return;
  isDrawing = true;
  ensureAudio();

  const btn = document.getElementById('drawBtn');
  btn.disabled = true;
  btn.textContent = 'ÊäΩÂ•ñ‰∏≠...';

  const window_ = document.getElementById('prizeWindow');
  const emojiEl = document.getElementById('prizeEmoji');
  const textEl = document.getElementById('prizeText');
  const amountEl = document.getElementById('prizeAmount');
  const glow = document.getElementById('bigWinGlow');

  glow.classList.remove('active');
  window_.classList.remove('reveal');
  window_.classList.add('rolling');
  amountEl.textContent = '';

  const result = drawPrize();

  let rollCount = 0;
  const rollInterval = setInterval(() => {
    emojiEl.textContent = rollingEmojis[Math.floor(Math.random() * rollingEmojis.length)];
    textEl.textContent = ['?', '??', '???'][rollCount % 3];
    playTick();
    rollCount++;
  }, 100);

  const duration = 1500 + Math.random() * 1000;
  setTimeout(() => {
    clearInterval(rollInterval);
    window_.classList.remove('rolling');
    window_.classList.add('reveal');

    emojiEl.textContent = result.emoji;
    textEl.textContent = result.name;
    amountEl.textContent = `${result.amount} ÂÖÉÁ∫¢ÂåÖ`;

    playWin(result.tier);

    if (result.tier <= 2) {
      glow.classList.add('active');
      spawnConfetti();
    }

    document.querySelectorAll('.prize-row').forEach(row => {
      row.classList.toggle('won', parseInt(row.dataset.tier) === result.tier);
    });

    state.remaining--;
    state.history.unshift({ tier: result.tier, name: result.name, amount: result.amount });
    saveState();
    updateUI();

    btn.disabled = false;
    btn.textContent = state.remaining > 0 ? 'ÂÜçÊäΩ‰∏ÄÊ¨°' : 'Â∑≤Áî®ÂÆå';
    if (state.remaining <= 0) btn.disabled = true;

    isDrawing = false;
    addHistoryEntry(state.history[0], 5 - state.remaining);
  }, duration);
}

function addHistoryEntry(entry, num) {
  const section = document.getElementById('historySection');
  const list = document.getElementById('historyList');
  section.style.display = 'block';

  const item = document.createElement('div');
  item.className = 'history-item';
  item.innerHTML = `
    <span class="h-num">#${num}</span>
    <span class="h-prize">${entry.name}</span>
    <span class="h-amount">${entry.amount} üßß</span>
  `;
  list.prepend(item);
}

function updateUI() {
  document.getElementById('remainCount').textContent = state.remaining;
  if (state.remaining <= 0) {
    const btn = document.getElementById('drawBtn');
    btn.disabled = true;
    btn.textContent = 'ÊäΩÂ•ñÊ¨°Êï∞Â∑≤Áî®ÂÆå';
  }
}

// ====== Confetti ======
function spawnConfetti() {
  const colors = ['#f1c40f', '#e74c3c', '#ff6b6b', '#ffd93d', '#ff9f43', '#ee5a24'];
  for (let i = 0; i < 50; i++) {
    const piece = document.createElement('div');
    piece.className = 'confetti-piece';
    piece.style.left = Math.random() * 100 + 'vw';
    piece.style.top = '-10px';
    piece.style.width = (6 + Math.random() * 8) + 'px';
    piece.style.height = (6 + Math.random() * 8) + 'px';
    piece.style.background = colors[Math.floor(Math.random() * colors.length)];
    piece.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
    piece.style.animationDuration = (2 + Math.random() * 2) + 's';
    piece.style.animationDelay = (Math.random() * 0.5) + 's';
    document.body.appendChild(piece);
    setTimeout(() => piece.remove(), 4500);
  }
}

// ====== Background Particles ======
function createParticles() {
  for (let i = 0; i < 8; i++) {
    const p = document.createElement('div');
    p.className = 'bg-particle';
    const size = 2 + Math.random() * 4;
    p.style.width = size + 'px';
    p.style.height = size + 'px';
    p.style.left = Math.random() * 100 + 'vw';
    p.style.background = `rgba(241, 196, 15, ${0.1 + Math.random() * 0.2})`;
    p.style.animationDuration = (8 + Math.random() * 12) + 's';
    p.style.animationDelay = (Math.random() * 10) + 's';
    document.body.appendChild(p);
  }
}

// ====== Init ======
document.getElementById('drawBtn').addEventListener('click', startDraw);

if (state.history.length > 0) {
  state.history.slice().reverse().forEach((entry, i) => {
    addHistoryEntry(entry, i + 1);
  });
}

updateUI();
createParticles();

// Reset: long press footer 3s
const footer = document.querySelector('.footer');
let pressTimer;
footer.addEventListener('touchstart', () => {
  pressTimer = setTimeout(() => {
    if (confirm('ÈáçÁΩÆÊäΩÂ•ñÊ¨°Êï∞Ôºü')) {
      state = { remaining: 5, history: [] };
      saveState();
      location.reload();
    }
  }, 3000);
});
footer.addEventListener('touchend', () => clearTimeout(pressTimer));
</script>
</body>
</html>
